var k=Object.create;var p=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var E=a=>p(a,"__esModule",{value:!0});var P=(a,t)=>{E(a);for(var n in t)p(a,n,{get:t[n],enumerable:!0})},$=(a,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of N(t))!V.call(a,e)&&e!=="default"&&p(a,e,{get:()=>t[e],enumerable:!(n=D(t,e))||n.enumerable});return a},u=a=>$(E(p(a!=null?k(H(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var h=(a,t,n)=>new Promise((e,s)=>{var i=c=>{try{l(n.next(c))}catch(m){s(m)}},r=c=>{try{l(n.throw(c))}catch(m){s(m)}},l=c=>c.done?e(c.value):Promise.resolve(c.value).then(i,r);l((n=n.apply(a,t)).next())});P(exports,{default:()=>T});var A=u(require("obsidian"));function S(a){let t=a==="next"?"nextElementSibling":"previousElementSibling";return function(n,e){let s=n[t],i=[s];for(;s;){if(s.matches(e))return i;s=s[t],i.push(s)}}}var v=S("next"),x=S("previous");var M="cm-hashtag-begin",K=`.${M}`,b="cm-hashtag-end",O=`.${b}`,o=class{constructor(t){this.equals=t=>this.tag===t.tag;let n=t.replace("#","").toLocaleLowerCase();this._text=n}get raw(){return this._text}get tag(){return`#${this._text}`}get subTags(){return this._text.split("/").reduce((t,n,e)=>{let s=e>0?t[e-1]:null,i=s?`${s.raw}/${n}`:n;return[...t,o.create(i)]},[])}get hasSubTags(){return this.subTags.filter(t=>!t.equals(this)).length>0}static isTagNode(t){return t instanceof o?!0:t.classList.contains("tag")||t.classList.contains("cm-hashtag")}static buildTagFromPartial(t){let n=x(t,K),e=v(t,O),s=t.classList,i=[];s.contains(b)?i=[...n,t]:s.contains(M)?i=[t,...e]:i=[...n,t,...e];let r=i.map(l=>l.textContent).join("");return o.create(r)}static create(t){if(t instanceof o)return t;let n=typeof t=="string"?t:t.textContent;return new o(n)}static equals(t,n){return t.equals(n)}};var y=u(require("obsidian"));var d=u(require("obsidian"));function C(a){let t=a.vault.getMarkdownFiles(),n=new Set;for(let e of t){let s=(0,d.getAllTags)(a.metadataCache.getCache(e.path))||[];if(!!s.length)for(let i of s)n.add(i.toLocaleLowerCase())}return n}function L(a,t){let n=a.vault.getMarkdownFiles(),e=new Set;for(let s of n){let i=(0,d.getAllTags)(a.metadataCache.getCache(s.path))||[];!i.length||i.indexOf(t.tag)===-1||e.add(s)}return e}function q(){return navigator.platform.startsWith("Mac")}function R(a){return q()?a.metaKey:a.ctrlKey}function _(a,t,n,e){return h(this,null,function*(){let s=a.metadataCache.getFirstLinkpathDest(t,n.path),i=a.vault.getConfig("defaultViewMode");yield a.workspace.getLeaf(R(e)).openFile(s,{active:!0,mode:i})})}function F(a,t,n){let e=I("a",t.basename);return e.style.cursor="pointer",e.dataset.href=t.path,e.classList.add("internal-link"),e.onclick=s=>{_(a,t.path,t,s),typeof n=="function"&&n(s)},e}function I(a,t){let n=document.createElement(a);return n.setText(t),n}function j(a,t){return a.name>t.name?1:a.name<t.name?-1:0}var g=class extends y.Modal{constructor(t,n){super(t);this.tag=n;this.onSelectTag=t=>{this.tag=o.create(t),this.contentEl.empty(),this.renderContent()};this.renderSubTagScope=t=>{let n=this.originalTag.subTags.filter(s=>!s.equals(this.tag)),e=t.createEl("select",{cls:"dropdown"});e.style.marginBottom="1em",e.value=this.tag.tag,e.onchange=s=>{this.onSelectTag(s.target.value)},e.createEl("option",{value:"",text:"Change tag scope"}),n.forEach(s=>{e.createEl("option",{value:s.tag,text:s.tag})})};this.originalTag=n}onOpen(){this.renderContent()}onClose(){this.contentEl.empty()}renderContent(){let t=this.tag,n=L(this.app,t),e=document.createDocumentFragment();e.createEl("h2",{text:`Pages with ${t.tag}`}),this.originalTag.hasSubTags&&this.renderSubTagScope(e),n.size===0?this.renderEmptyContent(e):this.renderLinks(e,n),this.contentEl.appendChild(e)}renderLinks(t,n){let e=t.createEl("ul"),s=Array.from(n).sort(j);for(let i of s){let r=e.createEl("li"),l=F(this.app,i,()=>this.close());r.appendChild(l)}}renderEmptyContent(t){t.createEl("p","There are no pages containing this tag")}};var w=u(require("obsidian"));var f=class extends w.Modal{constructor(t){super(t);this.hasNoMatch=!1;this.tags=new Set}onOpen(){this.renderContent(),this.tags=C(this.app)}onClose(){this.contentEl.empty(),this.tags.clear(),this.inputValue=void 0,this.hasNoMatch=!1}renderContent(){let t=document.createDocumentFragment(),n=t.createEl("h2",{text:"Search tag"});n.style.marginTop="0px";let e=t.createEl("form"),s=e.createEl("input",{attr:{id:"tag-search",name:"tag-search",type:"text",placeholder:"Search..."},value:this.inputValue}),i=e.createEl("button",{attr:{type:"submit"},text:"Search"});i.style.marginLeft="5px",e.onsubmit=r=>{r.preventDefault(),this.handleSubmit(r.target)},this.hasNoMatch&&t.createEl("p",{text:`#${this.inputValue.replace("#","")} did not match any tags in your vault`}),this.contentEl.appendChild(t),s.focus()}handleSubmit(t){let e=new FormData(t).get("tag-search").toString().trim();if(!e.length)return;this.inputValue=e;let s=o.create(e);this.tags.has(s.tag)?(this.hasNoMatch=!1,new g(this.app,s).open(),this.close()):(this.contentEl.empty(),this.hasNoMatch=!0,this.renderContent())}};var T=class extends A.Plugin{onload(){return h(this,null,function*(){this.registerDomEvent(document,"click",t=>{this.handleClick(t.target)}),this.addCommand({id:"open-tag-page-preview-modal",name:"Search",callback:()=>{new f(this.app).open()}})})}handleClick(t){var i;if(!o.isTagNode(t))return;let n=this.app.workspace.activeLeaf.getViewState(),e=null;if(((i=n.state)==null?void 0:i.mode)==="source"?e=o.buildTagFromPartial(t):e=o.create(t),!e){console.error("Tag is empty",{viewState:n,target:t});return}new g(this.app,e).open()}};0&&(module.exports={});
